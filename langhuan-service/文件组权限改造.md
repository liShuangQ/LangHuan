## 设计说明
1. 文件组可见性 ：
   - 在 t_rag_file_group 表中添加 visibility 字段，用于区分文件组是私有还是公开
   - 默认值设为 'private' ，表示新创建的文件组默认为私有
2. 文件组共享权限 ：
   - 创建新表 t_rag_file_group_share 来管理私有文件组的共享权限
   - 包含四种权限控制：读取、添加、更新、删除
   - 默认只给予读取权限，其他权限需要明确授予
   - 使用外键约束确保数据完整性
   - 添加唯一约束确保同一文件组不会重复共享给同一用户
3. 权限控制逻辑 ：
   - 公开文件组：所有用户可见，但只有创建者有修改权限
   - 私有文件组：只有创建者和被明确授权的用户可见
   - 被授权用户的具体权限由共享表中的权限设置决定
这种设计既满足了区分私有/公开的需求，又实现了灵活的权限分享机制，同时与现有的用户系统集成。

## 1. 插入文件组
```
-- 插入文件组（默认为私有）
INSERT INTO t_rag_file_group (group_name, 
group_type, group_desc, created_by, visibility)
VALUES ('知识库组1', 'document', '用于存储技术文档', 
'user123', 'private');

-- 插入公开文件组
INSERT INTO t_rag_file_group (group_name, 
group_type, group_desc, created_by, visibility)
VALUES ('公共资源库', 'resource', '公共资源文件组', 
'admin', 'public');
```
## 2. 文件组分享
```
-- 分享文件组给其他用户（授予读取和添加权限）
INSERT INTO t_rag_file_group_share (file_group_id, 
shared_with, can_read, can_add, can_update, 
can_delete, shared_by)
VALUES (1, 2, TRUE, TRUE, FALSE, FALSE, 1);
```
## 3. 查询文件组（根据用户权限）
### 超级管理员查询所有文件组
```
-- 超级管理员查询所有文件组
SELECT 
    fg.id,
    fg.group_name,
    fg.group_type,
    fg.group_desc,
    fg.visibility,
    fg.created_by,
    fg.created_at,
    'admin' as permission_type,
    TRUE as can_read,
    TRUE as can_add,
    TRUE as can_update,
    TRUE as can_delete
FROM t_rag_file_group fg
ORDER BY fg.created_at DESC;
```
### 普通用户查询文件组
```
-- 普通用户查询文件组（公开的 + 自己创建的 + 被分享的）
SELECT DISTINCT
    fg.id,
    fg.group_name,
    fg.group_type,
    fg.group_desc,
    fg.visibility,
    fg.created_by,
    fg.created_at,
    CASE 
        WHEN fg.created_by = ? THEN 'owner'
        WHEN fg.visibility = 'public' THEN 'public'
        WHEN fgs.id IS NOT NULL THEN 'shared'
        ELSE 'none'
    END as permission_type,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' THEN TRUE
        WHEN fgs.can_read = TRUE THEN TRUE
        ELSE FALSE
    END as can_read,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_add = TRUE THEN TRUE
        ELSE FALSE
    END as can_add,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_update = TRUE THEN TRUE
        ELSE FALSE
    END as can_update,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_delete = TRUE THEN TRUE
        ELSE FALSE
    END as can_delete
FROM t_rag_file_group fg
LEFT JOIN t_rag_file_group_share fgs ON fg.id = 
fgs.file_group_id AND fgs.shared_with = ?
WHERE 
    fg.visibility = 'public'  -- 公开的文件组
    OR fg.created_by = ?      -- 自己创建的文件组
    OR fgs.id IS NOT NULL     -- 被分享的文件组
ORDER BY fg.created_at DESC;
```
## 4. 查询文件（带权限信息）
### 超级管理员查询文件
```
-- 超级管理员查询所有文件
SELECT 
    f.id,
    f.file_name,
    f.file_type,
    f.file_size,
    f.document_num,
    f.file_desc,
    f.file_group_id,
    f.uploaded_by,
    f.uploaded_at,
    fg.group_name,
    fg.visibility as group_visibility,
    'admin' as permission_type,
    TRUE as can_read,
    TRUE as can_add,
    TRUE as can_update,
    TRUE as can_delete
FROM t_rag_file f
INNER JOIN t_rag_file_group fg ON f.file_group_id 
= fg.id::VARCHAR
ORDER BY f.uploaded_at DESC;
```
### 普通用户查询文件
```
-- 普通用户查询文件（根据文件组权限）
SELECT DISTINCT
    f.id,
    f.file_name,
    f.file_type,
    f.file_size,
    f.document_num,
    f.file_desc,
    f.file_group_id,
    f.uploaded_by,
    f.uploaded_at,
    fg.group_name,
    fg.visibility as group_visibility,
    CASE 
        WHEN fg.created_by = ? THEN 'group_owner'
        WHEN fg.visibility = 'public' THEN 'public'
        WHEN fgs.id IS NOT NULL THEN 'shared'
        ELSE 'none'
    END as permission_type,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' THEN TRUE
        WHEN fgs.can_read = TRUE THEN TRUE
        ELSE FALSE
    END as can_read,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_add = TRUE THEN TRUE
        ELSE FALSE
    END as can_add,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_update = TRUE THEN TRUE
        ELSE FALSE
    END as can_update,
    CASE 
        WHEN fg.created_by = ? THEN TRUE
        WHEN fg.visibility = 'public' AND fg.
        created_by = ? THEN TRUE
        WHEN fgs.can_delete = TRUE THEN TRUE
        ELSE FALSE
    END as can_delete
FROM t_rag_file f
INNER JOIN t_rag_file_group fg ON f.file_group_id 
= fg.id::VARCHAR
LEFT JOIN t_rag_file_group_share fgs ON fg.id = 
fgs.file_group_id AND fgs.shared_with = ?
WHERE 
    fg.visibility = 'public'  -- 公开文件组的文件
    OR fg.created_by = ?      -- 自己创建的文件组的文
    件
    OR fgs.id IS NOT NULL     -- 被分享文件组的文件
ORDER BY f.uploaded_at DESC;
```

## 5. 权限逻辑总结
### 文件组权限：
- 超级管理员 ：查看所有文件组，拥有全部权限
- 普通用户 ：
  - 公开文件组：所有人可见，只有创建者可编辑
  - 私有文件组：只有创建者和被分享用户可见，权限按分享设置
### 文件权限：
- 超级管理员 ：查看所有文件，拥有全部权限
- 普通用户 ：
  - 公开文件组中的文件：所有人可见，创建者可编辑
  - 私有文件组中的文件：按文件组分享权限执行
这个设计确保了权限的精确控制，同时通过合适的索引保证了查询性能。